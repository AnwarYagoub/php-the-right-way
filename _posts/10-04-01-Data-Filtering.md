---
title: تصفية البيانات
isChild: true
anchor:  data_filtering
---

## تصفية البيانات {#data_filtering_title}

لا تقم (أبداً) بالوثوق بأي مدخلات إلى التطبيق أو المصدر. دائماً قم بتعقيم ومراجعة هذه المدخلات قبل استخدامها في المصدر.
الدالتان `filter_var()` و `filter_input()` يمكنهما تعقيم ومراجعة صيغ النصوص ( كيغة البريد الإلكتروني مثلاً).

المدخلات الأجنبية يمكن أن تكون أي شيء: `$_GET` و `$_POST` كمدخلات النماذج، بعض القيم من المتغيرات العامة `$_SERVER`،
وأي محتوى طلب HTTP باستخدام `fopen('php://input', 'r')`. تذكر بأن المدخلات الأجنبية ليست محصورة على المدخلات من النماذج
المرسلة من المستخدم. الملفات المرفوعة والمحملة وقيم المتغيرات وبيانات الكوكيز وبيانات تطبيقات وخدمات الويب
هي مدخلات أجنبية أيضاً.

طالما يحتمل أن يتم حفظ البيانات والوصول إليها لاحقاً، فهي ما تزال مدخلات أجنبية. في كل مرة تقوم بمعالجة أو دمج أو أدراج
بيانات في المصدر، تسأل ما إذا كانت البيانات تم تصفيها بطريقة صحيحة ويمكن الوثوق بها.

بشكل عام البيانات _تصفى_ بشكل مختلف بناءً على كيفيتها. مثلا، عند تمرير مدخلات أجنبية إلى مخرجات صفحة HTML عندها سيتم
تنفيذ HTML و JavaScript في الموقع! هذا ما يسمى Cross-Site Scripting (XSS) ويمكن أن يكون هجوماً خطيراً جداً.
طريقة لتفادي هذا الهجوم هو عن طريق تعقيم كل البيانات التي ستعرض للمسخدم قبل عرضها في الصفحة عن طريق حذف كل وسوم HTML
باستخدام الدالة `strip_tags()` أو إسقاط الرموز والوسوم باستخدام دوال ذات معنى خاص بعناصر HTML `htmlentities()` أو 
`htmlspecialchars()`.

مثال آخر، تمرير قيم لكي يتم تنفيذها على شكل أمر. فهذا يعتبر من أخطر المهددات (وهي فكرة سيئة)، ولكن يمكن استخدام
الدالة `escapeshellarg()` لتعقيم وتنفيذ قيم الأمر.

مثال أخير وهو قبوم مدخلات أجنبية لتحديد ملف ما لعرضه من الملفات. قد تكون هذه ثغرة عن طريق تغيير اسم الملف إلى مسار ملف
ما. فستحتاج أن تقوم بإزالة كل من `"/"` و `"../"` وما يسمى [null bytes][6] وأي رموز من مسار الملف حتى لا يتم إدراج
ملفات خاصة أو محمية من العرض أو ملفات حساسة.

* [تعرف على المزيد عن data filtering][1]
* [تعرف على المزيد عن `filter_var`][4]
* [تعرف على المزيد عن `filter_input`][5]
* [تعرف على المزيد عن إدارة null bytes][6]

### التعقيم

التعقيم هو إزالة أو إسقاط أي رموز غير آمنة أو غير مصرح بها من المدخلات الأجنبية.

مثلاً يجب أن تقوم بتعقيم المدخلات الأجنبية قبل إدراج المدخل في HTML أو قبل إدراجها في إستعلام SQL مباشرة.
عندما تستخدم ربط القيم باستخدام [PDO](#databases) فستقوم PDO بتعقيم المدخلات تلقائياً.

بعض الأحيان قد تسمح ببعض وسوم HTML الآمن كمدخلات لتتضمن في محتوى صفحة HTML. تطبيق هذا صعب للغاية والبعض يقومون بتجنبه
باستخدام صيغة أكثر إحكاماً مثل Markdown أو BBCode بالرغم بأن هنالك مكتبات مخصصة لهذا السبب [HTML Purifier][html-purifier].

[Sanitization Filters][2]

### Unserialization

من الخطير تنفيذ عملية `unserialize()` من بيانات مدخلة من المستخدم أو من مصادر غير موثوقة. القيام بذلك يسمح للمستخدم أن يقوم بإنشاء
كائنات (بمحتوى مسبق التعريف) فسيتم تنفيذها من قبل destructor **حتى ولو لم يتم استخدام هذه الكائنات**. عندها يجب أن لا يتم عمل
unserialize لأي بيانات غير موثوقة.

إذا كان لابد أن تقوم بعمل unserialize لبيانات من مصادر غير موثوقة، عندها قم باستخدام خيار [`allowed_classes`][unserialize]
لتحديد أي نوع من الكائنات يمكن أن يتم عمل unserialize عليه. متوفر في إصدارة PHP7 فقط

### التحقق

يتم التحقق من البيانات الأجنبية المدخلة كما تتوقع منها أن تكون. مثلا قد تريد ان تتحقق من بريد إلكتروني و رقم هاتف
وعمر عندما تقوم بمعالجة طلب تسجيل.

[Validation Filters][3]


[1]: http://php.net/book.filter
[2]: http://php.net/filter.filters.sanitize
[3]: http://php.net/filter.filters.validate
[4]: http://php.net/function.filter-var
[5]: http://php.net/function.filter-input
[6]: http://php.net/security.filesystem.nullbytes
[html-purifier]: http://htmlpurifier.org/
[unserialize]: https://secure.php.net/manual/en/function.unserialize.php
